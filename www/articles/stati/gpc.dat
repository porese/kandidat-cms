<!-- Kan_title -->
magic_quotes_gpc<!-- Kan_title -->
<!-- Kan_content -->
<h2><img style="float:left" src="/media/admin_b.png" height="48" width="48" />Как бороться с magic_quotes_gpc</h2><p>В  настоящей статье пойдет речь об одном из конфигурационных параметров  языка программирования PHP — <strong>magic_quotes_gpc</strong>. Этот  параметр играет важную роль, касающуюся, прежде всего, безопасности  функционирования любого веб-приложения, обрабатывающего данные,  полученные от пользователя и использующего для их хранения базу данных  MySQL.</p><p>Параметр <strong>magic_quotes_gpc</strong> влияет на то,  как будут обрабатываться специальные символы, содержащиеся в данных,  передаваемых пользователем (массивы $_GET, $_POST, $_COOKIE). При<strong>  magic_quotes_gpc = 1</strong> эти спецсимволы [одиночные (') и двойные  кавычки ("), обратный слеш (), байт NULL] автоматически экранируются  интерпретатором PHP (перед каждым таким символом добавляется обратный  слеш). При <strong>magic_quotes_gpc = 0</strong> все данные передаются в  таком виде, в каком их ввел пользователь. В последнем случае в целях  безопасности требуется обрабатывать передаваемые данные (в противном  случае возможна атака SQL-injection) непосредственно в коде приложения.  Для этого в PHP существует функция <strong>addslashes</strong> (выдержка  из документации):</p><p><code>$str = "Is your name O'reilly?";<br /><br />#  выводит: Is your name O'reilly?<br />echo addslashes($str);</code></p><p>Все,  вроде бы, просто. Использование в коде приложения функции <strong>addslashes</strong>  в случае, если заведомо известно, что директива <strong>magic_quotes_gpc</strong>  равна 0, вполне обосновано. Но что если администратор хостинга решит  установить ее значение в единицу? Будет происходить двойное  экранирование спецсимволов! Поэтому, функцию <strong>addslashes</strong>  необходимо применять только в том случае, когда <strong>magic_quotes_gpc  = 0</strong>. Получить текущее значение данного конфигурационного  параметра можно при помощи стандартной функции <strong>get_magic_quotes_gpc.</strong>  Таким образом, более универсальный код будет иметь следующий вид:</p><p><code>$str  = "Is your name O'reilly?";<br />$str = (!get_magic_quotes_gpc()) ?  addslashes($str) : $str;<br /><br /># выводит при любых настройках PHP: Is  your name O'reilly?<br />echo $str;</code></p><p>Если писать каждый раз  такую конструкцию, то код разрабатываемого веб-приложения становится  достаточно громоздким. Гораздо эффективней использовать в начале каждого  файла PHP универсальный код, осуществляющий при необходимости описанную  выше обработку. Он будет иметь следующий вид:</p><p><code>function  addslashes_for_array(&amp;$arr)<br />{<br />&nbsp; &nbsp;foreach($arr as $k=&gt;$v)<br />&nbsp;  &nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp;if (is_array($v))<br />&nbsp; &nbsp; &nbsp; &nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp;addslashes_for_array($v);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$arr[$k] = $v;<br />&nbsp; &nbsp; &nbsp; &nbsp;}<br />&nbsp;  &nbsp; &nbsp; &nbsp;else<br />&nbsp; &nbsp; &nbsp; &nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$arr[$k] = addslashes($v);<br />&nbsp; &nbsp; &nbsp;  &nbsp;}<br />&nbsp; &nbsp;}<br />}<br /><br />function fix_magic_quotes_gpc()<br />{<br />&nbsp; &nbsp;if  (!get_magic_quotes_gpc())<br />&nbsp; &nbsp;{<br />&nbsp; &nbsp; &nbsp;  &nbsp;addslashes_for_array($_POST);<br />&nbsp; &nbsp; &nbsp; &nbsp;addslashes_for_array($_GET);<br />&nbsp;  &nbsp; &nbsp; &nbsp;addslashes_for_array($_COOKIE);<br />&nbsp; &nbsp;}<br />}<br /><br /># экранирует  при необходииости строки в $_GET, $_POST, $_COOKIE<br />fix_magic_quotes_gpc();</code></p><p>Следует  заметить, что описанный код учитывает также тот факт, что в переменных  $_GET, $_POST, $_COOKIE могут передаваться не только строки, но и  многомерные массивы строк.</p><p>P.S. В ходе проведенного недавно нашей  компанией исследования некоторых веб-сайтов выяснилось, что многие  достаточно известные веб-разработчики не учитывают параметр <strong>magic_quotes_gpc</strong>.  А жаль...</p><p>Взято с <a href="http://www.controlstyle.ru/">http://www.controlstyle.ru/</a></p><!-- Kan_content -->
<!-- Kan_myinclude -->
main<!-- Kan_myinclude -->
<!-- Kan_description -->
magic_quotes_gpc<!-- Kan_description -->
<!-- Kan_keywords -->
magic_quotes_gpc<!-- Kan_keywords -->
<!-- Kan_templatepage -->
<!-- Kan_templatepage -->
<!-- Kan_comment -->
0<!-- Kan_comment -->
<!-- Kan_pubdate -->
1281384000<!-- Kan_pubdate -->
<!-- Kan_tags -->
gpc<!-- Kan_tags -->
<!-- Kan_order -->
2<!-- Kan_order -->
